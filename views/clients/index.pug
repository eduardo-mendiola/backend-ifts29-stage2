extends ../layout.pug
//- views/clients/index.pug
block content
  .d-flex.justify-content-between.align-items-center.mb-4
    h1.mb-0 Lista de Clientes
    if hasPermission('create_clients')
      a.btn.btn-primary(href="/clients/new") Nuevo Cliente

  //- Incluir barra de búsqueda, modal y JS común
  include ../partials/common-table-scripts.pug  

  table.table.table-hover.table-dark.table-index
    thead
      tr
        th №
        th Código
        th Tipo
        th Nombre / Empresa
        th Ciudad
        th Email de Facturación
        th.text-end.pe-5 Acciones
    tbody
      if items && items.length
        each item, index in items
          tr(data-id=item.id, data-code=`${item.code}`, data-textmodal1=`Nombre: ${item.name}`)
            td= index + 1
            td= item.code
            td= item.client_type === 'company' ? 'Empresa' : 'Persona'
            td
              if item.client_type === 'company'
                = item.name
              else
                = (item.first_name || '') + ' ' + (item.last_name || '')
            td
              if item.address && item.address.city
                = item.address.city
              else
                | —
            td
              if item.billing_info && item.billing_info.email
                = item.billing_info.email
              else if item.email
                = item.email
              else
                | —
            td.text-end
              if hasPermission('view_clients')
                a.btn.btn-gray.btn-sm.me-2(href=`/clients/${item.id}`) Ver
              if hasPermission('edit_clients')
                a.btn.btn-gray.btn-sm.me-2(href=`/clients/${item.id}/edit`) Editar
              if hasPermission('delete_clients')
                form(action=`/api/clients/${item.id}?_method=DELETE`, method="POST", style="display:inline;")
                  input(type="hidden", name="_method", value="DELETE")
                  button.btn.btn-danger-soft.btn-sm.delete-btn(data-id=item.id) Eliminar
      else
        tr
          td(colspan="7", class="text-center py-4 text-muted") No hay clientes registrados.
