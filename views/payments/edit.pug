extends ../layout.pug
//- views/task/edit.pug
block content
  .d-flex.justify-content-center
    form.bg-dark.text-white.p-4.rounded.shadow(action=`/tasks/${item.id}?_method=PUT`, method="POST", style="width:100%; max-width:1200px; max-height:100vh; overflow-y:auto;")
      .d-flex.justify-content-between.align-items-center.mb-3
        h1.mb-0 Editar Tarea
        a.btn.btn-gray(href="/tasks", tabindex="11") Volver a la lista

      // Contenedor de 2 columnas
      .row.g-3
        // Columna izquierda
        .col-md-6
          .mb-3
            label.form-label(for="title") Título
            input#title.form-control(type="text", name="title", value=item.title || "", required, tabindex="1")
          .mb-3
          label.form-label(for="project_id") Proyecto
          select#project_id.form-select(name="project_id", required, tabindex="3")
            if projects && projects.length > 0
              each project in projects
                option(
                  value=project._id 
                  selected=(item.project_id && project._id.toString() === item.project_id._id.toString())
                ) #{project.name}
            else
              option(value="") No hay proyectos disponibles
          .mb-3
            label.form-label(for="description") Descripción
            textarea#description.form-control(name="description", required, tabindex="5")= item.description || ""
          .mb-3
            label.form-label(for="priority") Prioridad
            select#priority.form-select(name="priority", required, tabindex="7")
              option(value="baja" selected=(item.priority === "baja")) Baja
              option(value="media" selected=(item.priority === "media")) Media
              option(value="alta" selected=(item.priority === "alta")) Alta

        // Columna derecha
        .col-md-6
          .mb-3
            label.form-label(for="estimated_hours") Estimación (horas)
            input#estimated_hours.form-control(type="number", name="estimated_hours", value=item.estimated_hours || "", tabindex="2")
          .mb-3
            label.form-label(for="due_date") Fecha de Vencimiento
            input#due_date.form-control(type="date", name="due_date", value=item.due_date || "", tabindex="4")
          .mb-3
            label.form-label(for="status") Estado
            select#status.form-select(name="status", required, tabindex="6")
              option(value="pending" selected=(item.status === "pending")) Pendiente
              option(value="in_progress" selected=(item.status === "in_progress")) En Progreso
              option(value="completed" selected=(item.status === "completed")) Finalizado
          .mb-3
            label.form-label(for="assigned_to") Asignado
            select#assigned_to.form-select(name="assigned_to", required, tabindex="8")
              if employees && employees.length > 0
                each employee in employees
                  option(
                    value=employee._id 
                    selected=(item.assigned_to && employee._id.toString() === item.assigned_to._id.toString())
                  ) #{employee.first_name + ' ' + employee.last_name}  
              else
                option(value="") No hay usuarios disponibles 
        

      button.btn.btn-success.mt-3(type="submit", tabindex="9") Actualizar Tarea
      a.btn.btn-danger-soft.mt-3.ms-3(href="/tasks", tabindex="10") Cancelar