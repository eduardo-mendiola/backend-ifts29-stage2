extends ../layout.pug

block content
  .d-flex.justify-content-center
    form#userEditForm.bg-dark.text-white.p-4.rounded.shadow.needs-validation(action=`/users/${item.id}?_method=PUT`, method="POST", style="width:100%; max-width:1200px; max-height:100vh; overflow-y:auto;", novalidate)
      .d-flex.justify-content-between.align-items-center.mb-3
        h1.mb-0 Editar Usuario
        a.btn.btn-gray(href="/users", tabindex="7") Volver a la lista

      // Contenedor de 2 columnas
      .row.g-3
        // Columna izquierda
        .col-md-6
          .mb-3
            label.form-label(for="email") Email
            input#email.form-control(
              type="email", 
              name="email", 
              value=item.email || "", 
              required, 
              tabindex="1",
              pattern="^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$"
            )
            .invalid-feedback Por favor ingresa un email válido con dominio completo (ej: usuario@dominio.com)
          .mb-3
            label.form-label(for="username") Nombre de usuario
            input#username.form-control(
              type="text", 
              name="username", 
              value=item.username || "", 
              required, 
              tabindex="3",
              minlength="3",
              title="Mínimo 3 caracteres"
            )
          .mb-3
            label.form-label(for="password_hash") Contraseña (dejar en blanco para no cambiar)
            input#password_hash.form-control(
              type="password", 
              name="password_hash", 
              placeholder="••••••••",
              tabindex="5",
              minlength="6",
              title="Mínimo 6 caracteres. Dejar vacío si no deseas cambiarla"
            ) 

        // Columna derecha
        .col-md-6
          .mb-3
            label.form-label(for="role_id") Rol (acceso)
            select#role_id.form-select(name="role_id", required, tabindex="2")
              each role in roles
                option(
                  value=role._id 
                  selected=(item.role_id && role._id.toString() === item.role_id._id.toString())
                ) #{role.name}
          .mb-3
            label.form-label(for="is_active") Estado
            select#is_active.form-select(name="is_active", required, tabindex="4")
              option(value="true" selected=(item.is_active === true)) Activo
              option(value="false" selected=(item.is_active === false)) Inactivo
          
         
      button.btn.btn-success.mt-3(type="submit", tabindex="5") Actualizar Usuario
      a.btn.btn-danger-soft.mt-3.ms-3(href="/users", tabindex="6") Cancelar

  script.
    // Validación de Bootstrap en tiempo real
    (function() {
      'use strict';
      const form = document.getElementById('userEditForm');
      const emailInput = document.getElementById('email');
      
      // Validar en tiempo real mientras escribes
      emailInput.addEventListener('input', function() {
        if (this.checkValidity()) {
          this.classList.remove('is-invalid');
          this.classList.add('is-valid');
        } else {
          this.classList.remove('is-valid');
          this.classList.add('is-invalid');
        }
      });
      
      // Validar al enviar
      form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    })();