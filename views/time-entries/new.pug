extends ../layout.pug
//- views/time-entries/new.pug
block content
  .d-flex.justify-content-center
    form.bg-dark.text-white.p-4.rounded.shadow(action="/time-entries", method="POST", style="width:100%; max-width:1200px; max-height:100vh; overflow-y:auto;")
      .d-flex.justify-content-between.align-items-center.mb-3
        h1.mb-0 Crear Registro de Actividad
        a.btn.btn-gray(href="/time-entries", tabindex="12") Volver a la lista

      // Contenedor de 2 columnas
      .row.g-3
        // Columna izquierda
        .col-md-6
          .mb-3
            label.form-label(for="date") Fecha de Realización
            input#date.form-control(type="date", name="date", value=item.date || new Date().toISOString().split('T')[0], tabindex="1")
          .mb-3
            label.form-label(for="task_id") Tarea Asociada
            select#task_id.form-select(name="task_id", required, tabindex="3")
              if tasks && tasks.length > 0
                each task in tasks
                  option(
                    value=task._id 
                    selected=(item.task_id && task._id.toString() === item.task_id._id.toString())
                  ) #{task.title} (#{task.code}) - Proyecto: #{task.project_id ? task.project_id.name : 'N/A'}
              else
                option(value="") No hay proyectos disponibles
          .mb-3
            label.form-label(for="description") Descripción
            textarea#description.form-control(name="description", required, tabindex="5")
          .mb-3
            label.form-label(for="employee_id") Usuario
            select#employee_id.form-select(name="employee_id", required, tabindex="7")
              if employees && employees.length > 0
                each employee in employees
                  option(
                    value=employee._id 
                    selected=(item.employee_id && employee._id.toString() === item.employee_id._id.toString())
                  ) #{employee.first_name + ' ' + employee.last_name}  
              else
                option(value="") No hay usuarios disponibles
          .mb-3
            label.form-label(for="hours_worked") Horas trabajadas
            input#hours_worked.form-control(
              type="number", 
              name="hours_worked", 
              step="any",
              tabindex="9"
            )

        // Columna derecha
        .col-md-6
          .mb-3
            label.form-label(for="billable") Facturable
            select#billable.form-select(name="billable", required, tabindex="2")
              option(value="true" selected=(item.billable === true)) Si
              option(value="false" selected=(item.billable === false)) No
          .mb-3
            label.form-label(for="approved") Aprobado
            select#approved.form-select(name="approvede", required, tabindex="4")
              option(value="true" selected=(item.approved === true)) Si
              option(value="false" selected=(item.approved === false)) No
          .mb-3
            label.form-label(for="approved_by") Aprobado por
            select#approved_by.form-select(name="approved_by", required, tabindex="6")
              if managers && managers.length > 0
                each manager in managers
                  option(
                    value=manager._id
                    selected=(item.approved_by && manager._id.toString() === item.approved_by._id.toString())
                  ) #{manager.first_name} #{manager.last_name}
              else
                option(value="") No hay líderes disponibles
          .mb-3
            label.form-label(for="supervisor_comment") Comentario del supervisor
            textarea#supervisor_comment.form-control(name="supervisor_comment", required, tabindex="8")

      button.btn.btn-primary.mt-3(type="submit", tabindex="10") Crear Registro
      a.btn.btn-danger-soft.mt-3.ms-3(href="/time-entries", tabindex="11") Cancelar
