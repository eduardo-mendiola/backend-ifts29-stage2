extends ../layout.pug

block content
  .d-flex.justify-content-center
    form#teamRoleForm.bg-dark.text-white.p-4.rounded.shadow(
      action=`/team_roles/${item.id}?_method=PUT`,
      method="POST",
      style="width:100%; max-width:1200px; max-height:100vh; overflow-y:auto;"
    )
      .d-flex.justify-content-between.align-items-center.mb-3
        h1.mb-0 Editar Rol de Equipo
        a.btn.btn-gray(href="/team_roles") Volver a la lista

      .row.g-3
        .col-md-6
          .mb-3
            label.form-label(for="name") Título del Rol
            input#name.form-control(type="text", name="name", value=item.name || "", required)
          .mb-3
            label.form-label(for="description") Descripción
            textarea#description.form-control(name="description")= item.description || ""

      .mb-3
        div#alertContainer

      button.btn.btn-primary.mt-3(type="submit") Guardar Cambios

  script.
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('teamRoleForm');
      const alertContainer = document.getElementById('alertContainer');
      const itemId = '!{item.id}'; // Pug interpolación segura

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        alertContainer.innerHTML = '';

        const data = {
          name: form.name.value,
          description: form.description.value
        };

        try {
          const res = await fetch(`/team_roles/${itemId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });

          const result = await res.json();

          if (!result.success && result.message.includes('Ya existe')) {
            const div = document.createElement('div');
            div.className = 'alert alert-danger';
            div.textContent = result.message;
            alertContainer.appendChild(div);
          } else if (result.success) {
            window.location.href = `/team_roles/${itemId}`;
          }
        } catch (err) {
          console.error('Error en fetch:', err);
        }
      });

      form.querySelectorAll('input, textarea').forEach(input => {
        input.addEventListener('input', () => {
          alertContainer.innerHTML = '';
        });
      });
    });
