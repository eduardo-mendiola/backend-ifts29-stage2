extends layout.pug

block content
  .container-fluid.mt-4

    //- TARJETA DE USUARIO
    .row
      .col-md-12.mb-4
        .card
          .card-body
            .d-flex.align-items-center.mb-3
              if user && user.username
                .rounded-circle.bg-primary.text-white.d-flex.align-items-center.justify-content-center(style="width: 50px; height: 50px; font-size: 1.5rem;")
                  = user.username.charAt(0).toUpperCase()
                .ms-3
                  h6.mb-0= user.username
                  small.text-muted= user.email

            hr

            p.mb-1
              strong Rol: 
              span.badge.bg-info= user.role_id ? user.role_id.name : 'N/A'

            p.mb-1
              strong Código: 
              span.text-muted= user.code

            p.mb-0
              strong Estado: 
              if user.is_active
                span.badge.bg-success Activo
              else
                span.badge.bg-danger Inactivo




    //- CONTENIDO PRINCIPAL DEL PERFIL
    .row
      .col-md-12
        h2.mb-4 Mi Perfil


        //- INFORMACIÓN PERSONAL
        .card.mb-4
          .card-header
            h5.mb-0 Información Personal
          .card-body
            form(method="POST" action="/profile/update")
              .row
                .col-md-6.mb-3
                  label.form-label(for="username") Usuario
                  input.form-control(
                    type="text" 
                    id="username" 
                    name="username" 
                    value=user.username
                    readonly
                  )
                  small.form-text.text-muted El usuario no se puede modificar

                .col-md-6.mb-3
                  label.form-label(for="email") Email
                  input.form-control(
                    type="email" 
                    id="email" 
                    name="email" 
                    value=user.email
                    readonly
                  )
                  small.form-text.text-muted El email no se puede modificar

                .col-md-6.mb-3
                  label.form-label Último acceso
                  input.form-control(
                    type="text" 
                    value=user.last_login ? new Date(user.last_login).toLocaleString('es-ES') : 'Nunca'
                    readonly
                  )

                .col-md-6.mb-3
                  label.form-label Fecha de registro
                  input.form-control(
                    type="text" 
                    value=user.created_at ? new Date(user.created_at).toLocaleString('es-ES') : 'N/A'
                    readonly
                  )


        //- CAMBIO DE CONTRASEÑA
        .card
          .card-header
            h5.mb-0 Cambiar Contraseña
          .card-body
            form(method="POST" action="/profile/change-password")
              .row
                .col-md-12.mb-3
                  label.form-label(for="current_password") Contraseña Actual
                  input.form-control(
                    type="password" 
                    id="current_password" 
                    name="current_password" 
                    required
                  )

                .col-md-6.mb-3
                  label.form-label(for="new_password") Nueva Contraseña
                  input.form-control(
                    type="password" 
                    id="new_password" 
                    name="new_password" 
                    required
                    minlength="6"
                  )
                  small.form-text.text-muted Mínimo 6 caracteres

                .col-md-6.mb-3
                  label.form-label(for="confirm_password") Confirmar Contraseña
                  input.form-control(
                    type="password" 
                    id="confirm_password" 
                    name="confirm_password" 
                    required
                    minlength="6"
                  )

              .d-grid.gap-2.d-md-flex.justify-content-md-end
                button.btn.btn-primary(type="submit") Cambiar Contraseña
